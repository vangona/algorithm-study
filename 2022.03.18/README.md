# 11401번 이항 계수 3

---

## 수학적 지식

분할 정복에서는 수학적인 지식이 많이 필요해지는 것 같다.
정확히는 골드 3부터 수학적인 부분이 많이 필요해지는 것 같은데
한번 균형을 잡아야하는 것 같다.

## 분할 정복

이 문제를 통해서 분할 정복의 본질에 대해서 생각해볼 수 있었다.
분할 정복은 분할해서 문제를 풀이하는 것이지만,
덧셈과 뺄셈으로 분할하면 그것은 분할이 아니게 된다.

즉, 분할 정복에서의 점화식은 무조건 곱셈과 나눗셈으로 구현되어야한다.

이 부분이 동적계획법과 가장 큰 차이라고 느껴졌고
이러한 점 때문에 제곱을 사용하는 경우가 많아져서
이것에 대한 해결을 위해 수학적 지식이 많이 필요해지는 것 같다.

## 페르마의 소정리

이 문제는 페르마의 소정리를 사용하게 되어있다.

페르마의 소정리는

---

법 p가 소수일 때, a가 양의 정수라면
a^p와 a의 (mod p)는 합동이다.

---

이를 응용해서 구할 수 있는 식이
a^(p - 1)과 1 (mod p)가 합동,
a^(p - 2)와 a^-1 (mod p)가 합동이라는 것이다.

## 문제

https://www.acmicpc.net/problem/11401

문제를 정리하면,
수가 큰 이항 계수를 구하라는 것이다.

1 <= N <= 4,000,000
0 <= K <= N

- ( N K )의 이항 계수를 구하는 공식은
  N! / K!(N - K)!와 같다.

## 문제 접근

이항 계수가 자체가 팩토리얼이 사용되어 계산이 긴데,
수가 크다는 것은 분할 정복으로 풀어야한다는 것이었다.

N! / K!(N - K)!를 다르게 생각해본다면
N! \* (K!(N - K)) ^ -1이 된다.

이렇게 곱셈으로 표현되면, 모듈러 산술을 하기에 용이해진다.

위에서 페르마의 소정리에서 보았듯
a가 양의 정수, p가 소수일 때
a^(p - 2)와 a^-1 (mod p)가 합동이므로,
p를 10^9 + 7, 소수로 갖는 현재의 문제에서

(K!(N - K))^-1와 (K!(N - K))^p-2가 합동이 된다.

즉 위의 식은
N! (mod p) \* (K!(N - K))^p-2로 쓸 수 있다.

p - 2는 10^9 + 5이므로, 여기에서 분할정복을 사용한다.

## 필요한 함수들

필요한 동작들은

1. 팩토리얼 구하기
2. 분할 정복로 나눠볼 수 있겠다.

### 1. 팩토리얼 구하기

먼저 팩토리얼은 총 3개가 구해지기 때문에 dp를 사용하는 쪽이 더 효율적이었다.

문제는 반복문과 재귀에서의 선택이었는데,
자바스크립트 엔진의 최대 콜스택의 크기가 13939개 이므로
반복문을 사용해야했다.

### 2. 분할 정복

분할 정복 구현은 어렵지 않았다.
수가 크니 BigInt를 사용해야해서 코드가 복잡해진 것을 제외하면
무리없는 구현이었다.

## 후기

알고리즘 문제를 푸는데 코딩보다 수학적인 지식이 더 중요한 것 같다.
계속 이런 문제가 나온다면, 난이도를 낮추더라도
적당한 분류의 다양한 문제들을 풀어야겠다는 생각을 할 수 있었다.

---

## 리팩토링

시간이 4204ms로 굉장히 길었다.
리팩토링 할 수 있는 부분들을 최대한 찾아서 시간을 줄여보려고 한다.

먼저 생각 난 것은 이항 계수의 공식을 정리해서,
팩토리얼의 수를 줄여주는 것이었다.

이렇게 하게되면 N과 K가 모두 클 때,
팩토리얼을 구하기 위한 연산을 대폭 줄여줄 수 있을 것 같았다.

막상 구현해보니, 이렇게 만들 경우 dp를 사용하기 어려워졌다.
N ~ N - k까지의 곱만 구하게 팩토리얼 함수를 짜니
메모이제이션이 복잡해졌다.

다른 방법을 사용해봐야겠다.

아주 간단히 dp를 조금 수정해서 할 수 있었다.
반복문에서 쓸데없는 작업을 하며
dp에 값이 저장되지 않고 있었다.
